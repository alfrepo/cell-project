# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Spring Boot 3.5.6 application using Java 21 that provides a REST API for managing employee data stored in MongoDB. The project integrates with Kestra (workflow orchestration) and uses Spring Modulith for modular monolith architecture.

## Development Commands

### Prerequisites
Start the required infrastructure services (MongoDB, Mongo-Express, Kestra) before running the application:

```bash
cd docker
podman.up.mongo.bat      # Starts MongoDB + Mongo-Express
podman.up.kestra.bat     # Starts Kestra + PostgreSQL
```

### Build and Run
```bash
./gradlew build          # Build the project
./gradlew bootRun        # Run the application
./gradlew test           # Run all tests
./gradlew test --tests ClassName.testMethodName  # Run a single test
```

## Architecture

### Technology Stack
- **Framework**: Spring Boot 3.5.6 with Java 21
- **Data**: Spring Data MongoDB, Spring Data REST
- **Security**: Spring Security (basic auth: user/password in dev)
- **API**: REST endpoints, GraphQL, Mustache templating
- **Modularity**: Spring Modulith 1.4.1
- **Testing**: JUnit 5, Testcontainers (MongoDB)

### Package Structure
- `digital.alf.cells` - Base package
  - `controller/` - REST controllers (e.g., EmployeeController)
  - `model/` - Domain entities annotated with MongoDB @Document
  - `repository/` - Spring Data MongoDB repositories extending MongoRepository

### Data Layer
- **MongoDB**: Primary data store on port 27017
  - Database: `myappdb`
  - Connection URI: `mongodb://localhost:27017/myappdb`
  - Collections: `employees`
- **Mongo-Express**: Web UI for MongoDB at http://localhost:8081/db/myappdb/
- Tests use Testcontainers for isolated MongoDB instances

### External Services
- **Kestra**: Workflow orchestration at http://localhost:8082
  - Credentials: admin@kestra.io / Admin1234
  - Backed by PostgreSQL
  - Uses separate Docker network (`kestra`)

### Infrastructure
The project uses Podman/Docker Compose with two separate compose files:
- `docker/docker-compose.mongo.dev.yml` - MongoDB + Mongo-Express (network: myapp-network)
- `docker/docker-compose.kestra.dev.yml` - Kestra + PostgreSQL (network: kestra)

These run in separate networks and must be started independently via the batch scripts.

## Key Implementation Patterns

### Domain Models
Entity classes use `@Document(collection = "...")` for MongoDB mapping with `@Id` for the primary key. The Employee model demonstrates the standard pattern with String IDs auto-generated by MongoDB.

### Repositories
Repositories extend `MongoRepository<Entity, ID>` to get CRUD operations and Spring Data REST endpoint generation automatically.

### REST Controllers
Controllers use constructor injection for repositories and expose endpoints. The root endpoint "/" returns all employees via `EmployeeController`.

### Testing Strategy
Integration tests use `@Testcontainers` with `MongoDBContainer` to spin up real MongoDB instances, ensuring tests run against actual database behavior rather than mocks.
